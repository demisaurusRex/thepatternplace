<div class="instructions-container">
  <div class="m-0 w-100">
    <% if @order %>
      <div class="pattern-title">
        <h2 class="card-title mx-auto text-center">Digital instructions</h2>
          <%= render "shared/pattern_bar", pattern: @pattern %>
      </div>
      <div class="accordion accordion-flush">
        <h3 class="mt-4 mb-1 text-center"> Sections </h3>
        <% @pattern.categories.each_with_index do |category, index|%>
          <div class="accordion-item">
            <div class="accordion-header">
              <div class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#category<%=index%>" role="button" aria-expanded="false" aria-controls="category<%=index%>">
                <h3 class="mb-0">
                  <%= category.name %> (<%= category.instructions.length %> steps)
                </h3>
              </div>
            </div>
            <div class="collapse accordion-collapse"  id="category<%=index%>">
              <div class="list-group list-group-flush">
                <% category.instructions.each do |instruction| %>
                  <%= link_to pattern_steps_path(@pattern, category_position: category.position,step: instruction.position) do %>
                    <div class="list-group-item d-flex flex-row align-items-center">
                      <div class="m-2">
                        <%= cl_image_tag instruction.image.key,
                            class: "instruction-thumbnail"
                        %>
                      </div>
                      <div><%= instruction.description[0..40] %>...</div>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <p>
        <button class="shadow p-2 m-2 bg-white text-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          Customise instructions
        </button>
      </p>
      <div class="collapse" id="collapseExample">
        <div class="card mx-3">
          <%= simple_form_for [@order, @customised_instruction] do |f| %>
            <div class="d-flex justify-content-center align-items-center">
              <%= f.input :name, label: false, placeholder:'Name', class: "m-0" %>
              <%= f.submit "Make an editable copy", class: "btn shadow p-2 m-2 bg-white rounded-pill" %>
            </div>
          <% end %>
          <div class="list-group">
            <li class="list-group-item"> <strong>Your copies</strong> </li>
            <% @order.customised_instructions.each do |customised_instruction|%>
              <%= link_to customised_instruction_path(customised_instruction) do%>
                <li class="list-group-item"> <%=customised_instruction.name%> </li>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="pattern-title">
        You need to purchase this pattern in order to see the instructions
      </div>
    <% end %>
  </div>
</div>
